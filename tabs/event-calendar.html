<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../fontawesome/css/all.min.css"> 
  <style>
    body {
        font-family: Arial, sans-serif;
    }

    .calendar {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        color:#D3AF37;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
    }

    .calendar-day {
        width: 100px;
        height: 100px;
        border: 1px solid #ccc;
        display: block;
        justify-content: center;
        align-items: center;
        color: azure;
        text-align: left; 
        padding-left: 3px;
    }

    .calendar-day:not(.empty) {
        cursor: pointer;
    }

    /* .calendar-day:hover {
        background-color: #d3af37;
    } */

    .today {
        background-color: #ffffffe3;
        color: black;
    }
    .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
    }

    .calendar-day-name {
        width: 100px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color:azure;
    }
      /* .event-details-parent{
        display: none; 
        position: fixed; 
        z-index: 1; 
        padding-top: 100px; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgb(0,0,0); 
        background-color: rgba(0,0,0,0.6); 
     }   
 */
    
     .event-details {
        position: absolute;
        background-color: #e92d2d;
        color: rgb(254, 255, 255);
        border: 1px solid #ccc;
        padding: 0.5rem;
        font-size: 20px;
        /* width: 500px; */
        display: none;
        z-index: 1000;
        text-align: center;
        width: 35%;
        height: 45%;
        top:40%;
        justify-content: space-between;
        /* background-color: #e92d2d;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        width: 30%; */

        
    } 


    .event-details-close {
        color:rgb(158, 157, 157);
        position: absolute;
        top: 5px;
        right: 5px;
        cursor: pointer;
        font-weight: bold;
        font-size: 26px;
    }
    .event-details-close:hover {
        color: #000;
    }
    #arrow {
        color:#f5f5f5;
        background-color: #d3af37;
        cursor: pointer;
        transform: scale(1.5);
        padding: 10px;
        margin: 10px;
        font-weight: bold;
    }
    .fa-solid {
    font-size: 20px; /* Adjust the size of the icons as needed */
    }

    #arrow {
        position: relative;
    top: -8px;
    right: 0px;
    background-color: #fff;
    border: 2px solid #000;
    border-radius: 50%;
    /* width: 60px;
    height: 80px; */
    margin-left: 20px;
    margin-right: 20px;
    top: 3px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: #000;
    box-shadow: 0px 0px 8px 0px rgba(0,0,0,0.5);
    }

    #arrow:hover {
        background-color: #000;
        color: #fff;
        cursor: pointer;
    }
    #upcoming-events {
        color:#f5f5f5;
    }

    .accessibility-options {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
    }
    .accessibility-options-content {
        background-color: #e92d2d;
        margin: auto;
        padding: 20px;
        border: 2px solid #888;
        width: 100%;
        /* width: 30%; */
    }


  </style>
</head>
<h1 style="text-align: center; padding-top: 25px; font-family: Arial, Helvetica, sans-serif;">Event Calendar</h1>

<body>
  <div id="calendar"></div>
  <!-- <div id="upcoming-events"><h2>Upcoming Events:</h2> </div> -->
  <script>

    let events = {};

    async function fetchEvents() {
        const response = await fetch('../data/events.json');
        events = await response.json();
        const currentDate = new Date();
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
        // updateUpcomingEvents(currentDate, events);
    }
    function updateUpcomingEvents(currentDate, events) {
    const upcomingEvents = Object.entries(events)
        .filter(([dateKey, event]) => new Date(dateKey) >= currentDate)
        .sort(([aDateKey], [bDateKey]) => new Date(aDateKey) - new Date(bDateKey));

    const upcomingEventsHtml = upcomingEvents
        .map(([dateKey, event]) => `<li>${event.title}: ${dateKey}</li>`)
        .join('');

    document.getElementById('upcoming-events').innerHTML = `
        <h2>Upcoming Events:</h2>
        <ul>${upcomingEventsHtml}</ul>
    `;
}

    fetchEvents();


    function pad(n) {
        return n < 10 ? '0' + n : n;
    }

    function generateCalendar(year, month) {
        // Handle year changes
        if (month < 0) {
            year -= 1;
            month = 11;
        } else if (month > 11) {
            year += 1;
            month = 0;
        }
        const currentDate = new Date();
        const currentYear = currentDate.getFullYear();
        const currentMonth = currentDate.getMonth();
        const currentDay = currentDate.getDate();

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);

        // initialize calendar
        let calendarHtml = `
            <div class="calendar">
                <div class="calendar-header">
                    <button id="arrow" onclick="generateCalendar(${year}, ${month - 1})"><i class="fas fa-arrow-left"></i></button>
                    <h2>${firstDay.toLocaleString('default', { month: 'long' })} ${year}</h2>
                    <button id="arrow" onclick="generateCalendar(${year}, ${month + 1})"><i class="fas fa-arrow-right"></i></button>

                </div>
                <div class="calendar-days">
        `;

        // days of week
        const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        for (const day of daysOfWeek) {
            calendarHtml += `<div class="calendar-day-name">${day}</div>`;
        }
        calendarHtml += `
            </div>
            <div class="calendar-grid">
                <div class="calendar-day empty"></div>
        `;

        for (let i = 1; i < firstDay.getDay(); i++) {
            calendarHtml += `<div class="calendar-day empty"></div>`;
        }

        for (let day = 1; day <= lastDay.getDate(); day++) {
            const dateKey = `${year}-${pad(month + 1)}-${pad(day)}`;
            const event = events[dateKey];
            const eventTitle = event ? `<div class="calendar-event-title">${event.title}</div>` : '';
            const isToday =
                year === currentYear && month === currentMonth && day === currentDay;
                calendarHtml += `
                    <div
                        class="calendar-day${isToday ? ' today' : ''}"
                        onclick="onDayClick(${year}, ${month}, ${day})"
                    >
                        ${day}${eventTitle}
                    </div>
                    `;
        }

        calendarHtml += `
            </div>
            <div id = "accessibility-options" class = "accessibility-options"></div>
            <div id="event-details" class="event-details"></div>
            </div>
        `;

        document.getElementById('calendar').innerHTML = calendarHtml;
    }

    function onDayClick(year, month, day, e = window.event) {
        const dateKey = `${year}-${pad(month + 1)}-${pad(day)}`;
        const eventData = events[dateKey];

        const eventDetails = document.getElementById('event-details');
        const eventDetailsContainer = document.getElementById('accessibility-options');
        if (eventData) {
            eventDetails.innerHTML = `
            <span class="event-details-close" onclick="closeEventDetails()">&times;</span>
            <strong>${eventData.title}</strong>
            <p> Time: ${eventData.startingtime || ''}</p>
            <p> Location: ${eventData.location || ''}</p>
            <p>${eventData.description || ''}</p>
            `;

            // const rect = e.target.getBoundingClientRect();
            // eventDetails.style.top = `${rect.top - eventDetails.offsetHeight}px`;
            // eventDetails.style.left = `${rect.left}px`;
            eventDetailsContainer.style.display = 'block';
            eventDetails.style.display = 'block';
        } else {
            eventDetailsContainer.style.display = 'none';
            eventDetails.style.display = 'none';
        }
    }
    // Reset calendar to the current month when the window loses focus
    window.addEventListener('blur', () => {
        const currentDate = new Date();
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    });


    // X to close event box
    function closeEventDetails() {
        const eventDetails = document.getElementById('event-details');
        const eventDetailsContainer = document.getElementById('accessibility-options');
        eventDetails.style.display = 'none';
        eventDetailsContainer.style.display = 'none';
    }

    const currentDate = new Date();
    generateCalendar(currentDate.getFullYear(), currentDate.getMonth());

  </script>
</body>
</html>

